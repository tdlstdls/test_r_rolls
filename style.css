@charset "UTF-8";

/* =========================================
   基本設定
   ========================================= */
/* 固定が効かない場合のみ適用してください */
html, body {
    height: auto; /* 100% から auto へ */
    margin: 0;
    overflow: visible; /* auto から visible へ */
    -webkit-text-size-adjust: 100%;
}
body { font-family: "Helvetica Neue", Arial, sans-serif; padding: 10px 15px; box-sizing: border-box; color: #333; background-color: #fff; }

/* =========================================
   ヘッダー
   ========================================= */
.header-row, 
.description-box, 
#result, 
.forecast-summary-container,
#table-global-controls {
    flex-shrink: 0;
    width: auto;
    min-width: 100%;
    box-sizing: border-box;
}

.header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-wrap: nowrap; gap: 10px; }
h1 { font-size: 20px; margin: 0; padding: 0; white-space: nowrap; }
.header-actions { display: flex; align-items: center; gap: 4px; flex-wrap: nowrap; }

.text-btn { cursor: pointer; color: #007bff; font-weight: bold; font-size: 0.9em; text-decoration: underline; white-space: nowrap; padding: 2px 4px; user-select: none; }
.text-btn:hover { color: #0056b3; background-color: #f0f8ff; border-radius: 3px; }
.text-btn.active { color: #28a745; text-decoration: none; border: 1px solid #28a745; border-radius: 3px; padding: 1px 3px; }
.separator { color: #ccc; font-size: 0.8em; margin: 0 2px; user-select: none; }

/* =========================================
   ボタン（通常）
   ========================================= */
button { cursor: pointer; padding: 6px 12px; background: #007bff; color: white; border: none; border-radius: 4px; font-size: 14px; }
button:hover { background: #0056b3; }
button.secondary { background: #6c757d; }
button.secondary:hover { background: #545b62; }
button.active { background: #28a745; }

/* =========================================
   ユーティリティ
   ========================================= */
.hidden { display: none !important; }
.description-box { background: #e9ecef; padding: 10px; border-radius: 4px; margin-bottom: 15px; font-size: 0.9em; }
.result-box {
    position: static;
    width: auto;
    max-height: 400px;
    overflow-y: auto;
    margin: 10px 0;
    border: 1px solid #ddd;
    background: #f9f9f9;
    padding: 8px;
    display: block;
    white-space: normal;
    word-break: break-all;
    overflow-x: hidden;
}
.error { color: red; font-weight: bold; }

/* テーブル内のタイトル行や操作行をスクロール時に固定したくない場合は、
   sticky-row の z-index を調整するか、特定の th の position を static にします */
thead tr:nth-child(1) th,
thead tr:nth-child(2) th {
    position: static; /* 1〜2行目は画面上部に固定せず、テーブルと一緒にスクロールさせる */
    z-index: 1;
}

/* テーブル全体のコンテナを画面いっぱいに広げる */
#rolls-table-container {
    overflow: auto;
    width: 100%;
    flex-grow: 1;
    border: 1px solid #ddd;
    display: block;
}

/* テーブル本体のスタイル */
table {
    border-collapse: separate;
    border-spacing: 0;
    width: auto;
    min-width: max-content; /* テーブルを無理に縮めさせない */
}

/* [修正] 全てのセルを常に左揃えに */
th, td {
    border-right: 1px solid #ddd !important;
    border-bottom: 1px solid #ddd !important;
    padding: 6px;
    text-align: left; /* centerから変更 */
    white-space: nowrap;
    box-sizing: border-box;
    font-size: 13px;
}

/* 操作パネルのスタイル（従来通りの表示を保証） */
#table-global-controls {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 10px;
    padding: 8px;
    background: #f8f9fa;
    border-bottom: 1px solid #ddd;
    width: 100%; /* 横幅いっぱいに広げる */
    box-sizing: border-box;
}

/* 追加：テーブルとスペーサーを横に並べるラッパー */
.table-horizontal-wrapper {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    /* min-width: 100%; を解除 */
}

th { background-color: #f8f9fa; font-weight: bold; border-top: 1px solid #ddd; border-bottom: 1px solid #ddd; box-shadow: 0 1px 0 #ddd; }

/* ガチャ名称行を最上部に固定 */
.sticky-row th {
    position: -webkit-sticky; /* iPhone/Safari対策 */
    position: sticky;
    top: 0; 
    z-index: 100 !important; /* 他の要素より手前に */
    background-color: #f8f9fa !important; /* 透け防止 */
    border-bottom: 2px solid #ccc !important; /* 境界線を太くして固定感を出す */
}

/* 修正: A/Bトラック名(3行目)も固定したい場合は以下を追加 */
.track-header {
    position: sticky;
    top: -40px; /* 上の行の高さ分マイナスにするか、一緒にstickyにする */
    z-index: 90;
    background: #f8f9fa;
}

/* iPhone/Safari対策: テーブル要素の sticky 動作を安定させる */
#rolls-table-container {
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    display: block; /* inline-block や flex を避ける */
}

table {
    border-collapse: separate; /* collapse だと sticky が効かないブラウザが多い */
    border-spacing: 0;
}

.control-row th { position: static; border-top: none; background-color: #f8f9fa; padding-top: 2px; padding-bottom: 4px; z-index: 1; }

/* NO列など中央揃えを維持したい箇所のみ上書き */
.col-no { text-align: center !important; background-color: #f8f9fa; width: 30px; z-index: 40 !important; }

/* NO列（横固定）と名称（縦固定）が重なる角のセルを最前面に */
.sticky-row th.col-no {
    z-index: 110 !important;
    left: 0;
}

.calc-column { background-color: #f0f8ff; font-size: 0.9em; color: #555; }
/* 通常時の列幅設定（既存の 170px を維持） */
.gacha-column, 
.gacha-cell {
    width: 170px !important;
    min-width: 170px !important;
    max-width: 170px !important;
    box-sizing: border-box;
    text-align: left !important;
    white-space: normal !important;
    word-break: break-all !important;
    line-height: 1.2;
    font-size: 14px;
}

/* 【強化】横幅圧縮モードの定義 */
.narrow-mode {
    /* ブラウザの自動計算を捨て、指定幅を強制するモード */
    table-layout: fixed !important; 
    width: auto !important;
    min-width: 0 !important; /* max-content指定を解除 */
}

.narrow-mode .gacha-column,
.narrow-mode .gacha-cell {
    width: 60px !important; /* 少し余裕を持たせて80px */
    min-width: 60px !important;
    max-width: 60px !important;
    padding: 2px 1px !important;
    overflow: hidden; /* はみ出した文字を隠す */
    font-size: 10px;
}

/* セル内のリンク文字が押し広げるのを防ぐ */
.narrow-mode .char-link {
    display: inline-block;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis; /* 長い名前は「...」にする */
    white-space: nowrap;
}

/* 確定枠(G列)の調整 */
.narrow-mode .guaranteed-cell {
    padding: 1px !important;
}

/* 圧縮モード時、確定枠内のテキストは...にせず折り返す */
.narrow-mode .guaranteed-cell .char-link {
    display: inline !important;
    white-space: normal !important;
}

.highlight { position: relative; }
.highlight-uber { font-weight: bold; color: #c2185b; }
.char-link:hover { color: #0056b3; }
.remove-btn { background: #dc3545; padding: 2px 6px; font-size: 10px; margin-left: 5px; }
.add-gacha-btn { background: #28a745; padding: 2px 8px; font-size: 11px; }
.uber-add-select { cursor: pointer; border: 1px solid #ccc; border-radius: 3px; background-color: #fff; }

/* =========================================
   スケジュール表 & ガントチャート共通
   ========================================= */
#schedule-container { padding: 20px; background-color: #fff; border-top: 1px solid #ddd; max-width: 100%; box-sizing: border-box; flex-grow: 1; overflow-y: auto; }
.schedule-scroll-wrapper { overflow-x: auto; max-height: none; border: 1px solid #ddd; max-width: 100%; }
.schedule-table { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 0; font-size: 14px; }
.schedule-table th,
.schedule-table td { border: 1px solid #ddd; padding: 8px; text-align: center; white-space: nowrap; }
.schedule-table td:nth-child(3) { white-space: normal; text-align: left; min-width: 250px; }
.schedule-table th { background-color: #eee; position: sticky; top: 0; z-index: 10; border-top: 1px solid #ddd; border-bottom: 1px solid #ccc; }
.row-ended { background-color: #e0e0e0 !important; color: #666; }
.row-ended .gantt-bar { filter: grayscale(100%); opacity: 0.6; }
.row-guaranteed { background-color: #ffffe0 !important; }

/* =========================================
   ガントチャート
   ========================================= */
.gantt-outer-wrapper * { box-sizing: border-box; }
.gantt-outer-wrapper { display: inline-block; max-width: 100%; vertical-align: top; width: 100%; }
.gantt-chart-container { border: 1px solid #ccc; background: #fff; font-size: 12px; margin-bottom: 20px; max-width: 100%; }
.gantt-scroll-wrapper { overflow-x: auto; position: relative; padding-bottom: 10px; width: 100%; }
.gantt-header { display: flex; border-bottom: 1px solid #ccc; background: #f9f9f9; position: sticky; left: 0; z-index: 6; }
.gantt-label-col { width: 160px; min-width: 160px; padding: 5px; border-right: 1px solid #ccc; background-color: inherit; position: sticky; left: 0; z-index: 5; display: flex; align-items: center; justify-content: center; font-weight: bold; border-bottom: 1px solid #eee; }
.gantt-header .gantt-label-col { background-color: #f9f9f9; }
.gantt-date-cell { border-right: 1px solid #eee; text-align: center; padding: 5px 0; font-size: 10px; flex-shrink: 0; }
.gantt-date-cell.today { background-color: #ffeb3b; }
.gantt-date-cell.weekend { background-color: #e0f7fa; }
.gantt-body { position: relative; }
.gantt-row { display: flex; border-bottom: 1px solid #eee; height: 30px; background-color: #fff; }
.gantt-row:hover { filter: brightness(0.95); }
.gantt-row .gantt-label-col { font-weight: normal; text-align: center; justify-content: center; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: block; line-height: 20px; }
.gantt-bar-area { position: relative; height: 100%; flex-grow: 1; }
.gantt-bar { position: absolute; top: 5px; height: 20px; background-color: #4caf50; border: 1px solid #4caf50; box-shadow: none; border-radius: 3px; color: #fff; font-size: 10px; display: flex; align-items: center; justify-content: center; overflow: hidden; white-space: nowrap; z-index: 2; }
.gantt-bar.g-kyoku { background-color: #e91e63; border-color: #e91e63; }
.gantt-bar.g-cho { background-color: #9c27b0; border-color: #9c27b0; }
.gantt-bar.g-fest { background-color: #ff9800; border-color: #ff9800; }
.gantt-bar.g-collab { background-color: #2196f3; border-color: #2196f3; }
.gantt-bar-text { padding: 0 4px; }
.gantt-grid-line { position: absolute; top: 0; bottom: 0; border-right: 1px solid #f5f5f5; z-index: 0; }
.gantt-grid-line.weekend { background-color: rgba(224, 247, 250, 0.3); }
.gantt-current-line { position: absolute; top: 0; bottom: 0; width: 2px; background-color: #ff0000; z-index: 1; opacity: 0.7; pointer-events: none; }

/* style.css に追記 */
.track-header {
    /* min-width: 280px; /* Aトラックの操作エリアが1行で収まる程度の幅 */
    box-sizing: border-box;
}

/* ボタンがアクティブな時の色（任意） */
#toggle-width-btn.active {
    background-color: #28a745;
    color: white;
}

